import serial
import time
import json

response = bytearray.fromhex("68b1b16808007254498105b405c004230000000406eb7c0100041528860200844015000000008480401500000000052b75688cc0053bcd9e0b44055be8ffb041055fc80db14105630000debb058333b56f943f059b2c8c927f3f04223a460000342201000000b4402201000000046d2834c82b059328cdcccc3d854093280000803f85804093280000803f0c78544981050dfd1113474120474e49524554454d2041524745544e490bfd0e0101020cfd0d130012024816")

if response[0] == 0x68 and response[-1] == 0x16:
        print("Response ok")

data_length = response[1]
print(f"Data length: {data_length}")
        
data = response[7:-2]
print(data.hex())

output = {}

output["VERSION"] = data[6:7].hex()
output["ACC"] = data[8]
output["STATE"] = data[9]
output["SIGNATURE"] = data[10:12].hex()
output["counter_releve"] = int.from_bytes(data[14:18], "little")

for i, byte in enumerate(data):
        pass


print(json.dumps(output, indent=4))



with serial.Serial('COM8', 2400, 8, serial.PARITY_EVEN, 1, 1) as ser:
        command = bytearray.fromhex("105B005B16")
        
        ser.write(command)
        bs = ser.readline()
        print(bs.hex())

        # 68b1b16808007254498105b405c004230000000406eb7c0100041528860200844015000000008480401500000000052b75688cc0053bcd9e0b44055be8ffb041055fc80db14105630000debb058333b56f943f059b2c8c927f3f04223a460000342201000000b4402201000000046d2834c82b059328cdcccc3d854093280000803f85804093280000803f0c78544981050dfd1113474120474e49524554454d2041524745544e490bfd0e0101020cfd0d130012024816
        # 68B1B16808007254498105B405C0041C0000000406EB7C0100041526860200 84 40 15 00 00 00 00 84 80 40 15 00 00 00 00 05 2B C7 37 AA BF 05 3B 6E 3D 0C 44 05 5B 48 D6 B1 41 05 5F 98 E5 B1 41 05 63 00 00 F5 BB 05 83 33 AF 67 94 3F 05 9B 2C 09 91 7F 3F 04 22 3A 46 00 00 34 22 01 00 00 00 B4 40 22 01 00 00 00 04 6D 19 34 C8 2B 05 93 28 CD CC CC 3D 85 40 93 28 00 00 80 3F 85 80 40 93 28 00 00 80 3F 0C 78 54 49 81 05 0D FD 11 13 47 41 20 47 4E 49 52 45 54 45 4D 20 41 52 47 45 54 4E 49 0B FD 0E 01 01 02 0C FD 0D 13 00 12 02 14 16 
        
